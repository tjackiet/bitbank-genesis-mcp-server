// MCP Prompts 定義（既存の server 側プロンプトを集約）
import type { PromptMessage } from '@modelcontextprotocol/sdk/types.js';

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 型定義
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export enum PromptLevel {
  BEGINNER = 'beginner',
  INTERMEDIATE = 'intermediate',
  ADVANCED = 'advanced',
}

export enum PromptCategory {
  ANALYSIS = 'analysis',
  VISUALIZATION = 'visualization',
  EDUCATION = 'education',
  WORKFLOW = 'workflow',
}

export interface PromptMetadata {
  level: PromptLevel;
  category: PromptCategory;
  estimatedTime?: string;
  prerequisites?: string[];
  tags?: string[];
}

export interface PromptDef {
  name: string;
  description: string;
  // server 側 register 用: 既存 messages をそのまま移行
  messages: Array<{
    role: 'system' | 'assistant' | 'user';
    content: any[];
  }>;
  // 表示用の引数メタ（存在しない既存もあるため任意）
  arguments?: Array<{ name: string; description?: string; required?: boolean }>;
  metadata?: PromptMetadata;
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 用語解説データベース（Phase 1 要求分のみ）
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export interface TermExplanation {
  shortDef: string;
  analogy: string;
  ranges: Record<string, string>;
  usage: string;
  warning: string;
  related: string[];
}

export const termExplanations: Record<string, TermExplanation> = {
  RSI: {
    shortDef: '買われすぎ・売られすぎを数値化した指標',
    analogy: 'お店の人気度メーター',
    ranges: { '70': '買われすぎ（そろそろ下がるかも）', '30': '売られすぎ（そろそろ上がるかも）', default: '中立（どちらでもない）' },
    usage: '70以上で売り検討、30以下で買い検討',
    warning: '強いトレンドでは70以上・30以下が続くことがあります',
    related: ['MACD', 'ストキャスティクス'],
  },
  MACD: {
    shortDef: 'トレンドの勢いと転換点を見る指標',
    analogy: '自動車の加速・減速メーター',
    ranges: { goldenCross: 'ゴールデンクロス（買いシグナル）', deadCross: 'デッドクロス（売りシグナル）' },
    usage: '線が交差するタイミングで売買を検討',
    warning: 'ダマシも多いため他指標と併用',
    related: ['RSI', '移動平均線'],
  },
  ボリンジャーバンド: {
    shortDef: '価格が動く範囲を帯で示したもの',
    analogy: '道路の車線のようなもの',
    ranges: { upper: '上の帯（買われすぎの可能性）', lower: '下の帯（売られすぎの可能性）', middle: '中央線（平均価格）' },
    usage: '帯の外に出たら中央へ戻る可能性を考える',
    warning: '強いトレンドでは帯に沿って動き続けることがあります',
    related: ['移動平均線', 'ATR'],
  },
  板: {
    shortDef: '今出されている買い注文と売り注文のリスト',
    analogy: 'スーパーの値札と在庫数',
    ranges: { bid: '買い注文（買いたい人の希望価格と量）', ask: '売り注文（売りたい人の希望価格と量）' },
    usage: '厚い板の価格帯は突破しにくい「壁」になりやすい',
    warning: '板は一瞬で変わるため、スナップショットと捉える',
    related: ['スプレッド', '出来高'],
  },
  スプレッド: {
    shortDef: '買える最安値と売れる最高値の差',
    analogy: '店の買取価格と販売価格の差',
    ranges: { narrow: '狭い（100円以下）: 取引しやすい', wide: '広い（500円以上）: 価格が飛びやすい' },
    usage: 'スプレッドが狭い時の方が有利',
    warning: '流動性が低い時間帯は広がりやすい',
    related: ['板', '流動性'],
  },
  出来高: {
    shortDef: '一定期間に取引された数量',
    analogy: 'お店の来客数やレジ通過数',
    ranges: { high: '多い＝活発（注目度高い）', low: '少ない＝静か（値動き出にくい）', default: '平均的' },
    usage: '急増は注目イベントの可能性、トレンドの信頼性確認に併用',
    warning: '価格変動と併せて判断（出来高単独は誤認の恐れ）',
    related: ['トレンド', 'ボラティリティ'],
  },
  ローソク足: {
    shortDef: '一定期間の値動きを1本で表すチャート要素',
    analogy: '1日の天気をアイコンで表すイメージ',
    ranges: { long: '長い＝大きな値動き', short: '短い＝小さな値動き', default: '中程度' },
    usage: '実体とヒゲで勢い・拒否・反転の手がかり',
    warning: '1本だけで結論にせず、連続性や出来高も参照',
    related: ['トレンド', '出来高'],
  },
  移動平均線: {
    shortDef: '一定期間の平均価格をつないだ線',
    analogy: '道の傾き（上り坂/下り坂）',
    ranges: { bullish: '価格＞線＝強気傾向', bearish: '価格＜線＝弱気傾向', cross: '交差＝転換の兆し' },
    usage: '25/75/200などを組み合わせて方向性・支持抵抗を確認',
    warning: '遅行性があるため急変には鈍い',
    related: ['トレンド', 'ボラティリティ'],
  },
  トレンド: {
    shortDef: '価格が続いて動く方向性',
    analogy: '川の流れ（上流→下流）',
    ranges: { up: '上昇', down: '下降', range: '横ばい' },
    usage: '上昇は押し目買い、下降は戻り売りなど方針の基礎',
    warning: '時間軸で異なる方向が出るため軸の統一が必要',
    related: ['移動平均線', '出来高'],
  },
  ボラティリティ: {
    shortDef: '価格変動の大きさ',
    analogy: '波の高さ（荒波/凪）',
    ranges: { high: '高い＝大きく動く', low: '低い＝小さく動く', default: '平均的' },
    usage: 'リスク管理・ポジションサイズの目安、指標はATRやRVなど',
    warning: '高ボラは機会とリスクが同時に増える',
    related: ['出来高', '移動平均線'],
  },
};

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 公開プロンプト（docs/prompts-table.md に掲載）
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
const promptsAll: PromptDef[] = [
  {
    name: '🔰 BTCの価格を分析して',
    description: 'ビットコインの最近の価格動向とトレンドを初心者向けに分析',
    messages: [
      {
        role: 'assistant', content: [{
          type: 'text', text: `最近のBTCの動きを初級者向けに分析してください。

【表現ルール】
1. 専門用語は「わかりやすい言葉（正式名称）」で併記
   例: 加熱度（RSI）、平均価格（移動平均線）、トレンドの雲（一目均衡表）
2. 初出の指標には1行説明を添える
3. 数値だけでなく「意味」を説明
4. 指標間の関係性・整合性を明示
5. チャート不要、テキストのみ
6. 視覚的なゲージや絵文字を活用して直感的に理解できるようにする

【分析の流れ（ツールは3つ）】
1) get_candles(pair="btc_jpy", type="1day", limit=90)
   → 価格推移と出来高（contentに計算済み情報あり）
2) analyze_market_signal(pair="btc_jpy", type="1day")
   → 総合スコア、SMA詳細、補足指標（RSI・一目・MACD）を取得
3) analyze_indicators(pair="btc_jpy", type="1day", limit=50)
   → RSI推移（直近7日間）を取得して視覚化

【出力形式】

# 📊 BTC分析レポート

# Part 1: 市場の動き

## 📈 価格推移（3つの期間で比較）

【データソース】get_candles の content から取得

**現在価格：¥XX,XXX,XXX**

| 期間 | 価格 | 変化率 | 判定 |
|------|------|--------|------|
| 1週間前 | ¥XX,XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |
| 1ヶ月前 | ¥XX,XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |
| 3ヶ月前 | ¥XX,XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |

💡 [期間ごとの動きを1-2行で要約]
（例：短期では下落傾向ですが、3ヶ月で見ると上昇基調を維持しています）

※判定基準：+2%以上=上昇、-2%以下=下落、±2%以内=横ばい

## 💰 取引の活発さ

【データソース】get_candles の content「出来高推移」から取得

**直近1週間の出来高：XXX BTC/日**（前週比 ±XX.X%）

判定：[📈活発/📉落ち着いている/→通常]

💡 [出来高の意味を1行で]
（例：取引量は前週より増加しており、市場参加者の関心が高まっています）


# Part 2: 3つの主要指標で分析

## 総合スコア

**総合スコア：XX / 100**（[解釈テキスト]）

\`\`\`
-100 ◄──────────────┼──────────────► +100
       弱気        中立       強気
                    ▲
                  今ココ
\`\`\`

## 1️⃣ 加熱度（RSI）

**RSIとは**：0-100で測る指標。30以下=売られすぎ、70以上=買われすぎを示します。

**現在値：XX.X**
\`\`\`
[████░░░░░░] XX/100
\`\`\`
↑ [状態の説明]（例：売られすぎに近い、30以下で反発期待）

**📊 直近7日間の推移**：  
[analyze_indicators の本文から「RSI推移（直近7日）」を数値→矢印形式でそのまま引用]  
例: 25.6 → 23.4 → 16.1（底） → 33.4 → 32.2 → 34.4 → 35.7  
└─ [推移の解釈] [📈上昇中/📉下降中/→横ばい] [一言コメント]

※ ASCIIアートの折れ線グラフは描かないこと（位置ずれが発生するため）

**注意点**：
[RSI特有の注意点を1行で]（例：強いトレンド中は30以下・70以上が続くこともあります）

※ゲージの作り方：RSI値を10で割った数だけ█、残りは░（10ブロック制）


## 2️⃣ トレンドの強さ（移動平均線）

| 期間 | 移動平均価格 | 価格との差 | 判定 |
|------|-------------|-----------|------|
| 短期（25日） | XX,XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |
| 中期（75日） | XX,XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |
| 長期（200日） | XX,XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |

**移動平均線とは**：過去の平均価格を結んだ線。トレンド（方向性）を見る基本指標です。

**今の状態**：
[全体的な配置とトレンドを1-2行で]
（例：全ての移動平均線が価格の上にある → **弱気構造**。価格が短期線（約XX万円）を明確に超えない限り、本格的な上昇トレンドとは言えません）

**直近の動き**：
[クロスやその他の動きがあれば記載]
（例：9日前に短期線（25日）が中期線（75日）を上抜け（ゴールデンクロス）。短期的な反発開始のサインですが、まだ価格は全ての平均線の下にあります）

※判定の見方：
- 🟢強気：価格がその平均線より上（上昇傾向）
- 🔴弱気：価格がその平均線より下（下落傾向）
- 🟡中立：ほぼ同じ位置（転換期・横ばい）


## 3️⃣ トレンドの雲（一目均衡表）

**一目均衡表とは**：価格と「雲」（抵抗・支持帯）の位置関係でトレンドを判断する指標です。

**現在位置**：[雲の上🟢/雲の中🟡/雲の下🔴]

【雲の下（弱気）の場合】
\`\`\`
    ╔═══════════════════════╗
    ║ XX,XXX,XXX円  雲上端  ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XX,XXX,XXX円  雲下端  ║
    ╚═══════════════════════╝
         ↑ +X.X% 上方
 📍 XX,XXX,XXX円 ━━ 現在価格
\`\`\`

【雲の上（強気）の場合】
\`\`\`
 📍 XX,XXX,XXX円 ━━ 現在価格
         ↓ -X.X% 下方
    ╔═══════════════════════╗
    ║ XX,XXX,XXX円  雲上端  ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XX,XXX,XXX円  雲下端  ║
    ╚═══════════════════════╝
\`\`\`

【雲の中（不透明）の場合】
\`\`\`
    ╔═══════════════════════╗
    ║ XX,XXX,XXX円  雲上端  ║
    ║         ↑ +X.X%       ║
    ║ 📍 XX,XXX,XXX円 現在  ║
    ║         ↓ -X.X%       ║
    ║ XX,XXX,XXX円  雲下端  ║
    ╚═══════════════════════╝
\`\`\`

- 雲との距離：±X.X%（雲の[上端/下端]まで約XX万円）
- 雲の厚さ：X.X%（約XX万円）

💡 [状態の説明を1-2行で]
（例：雲の下にいるため、上昇には雲を突破する必要があります。雲は厚く、強い抵抗として機能しています）


## 📊 3指標の関係性

**整合性**：

| 指標 | 状態 | 判定 |
|------|------|------|
| RSI | XX | 🟢/🔴/🟡 |
| 移動平均線 | [配置] | 🟢/🔴/🟡 |
| 一目均衡表 | [位置] | 🟢/🔴/🟡 |

**総合解釈**：
[3つの指標を統合した解釈を2-3行で]
（例：「RSIは反発余地があり売られすぎ圏から脱出中🟡、しかし移動平均線・一目ともに弱気構造🔴。短期的な反発はあっても、上値は重い展開が予想されます」）


## 🎯 今後の注目ポイント

① **RSIが40回復** → 反発継続の兆し

現在：XX → 目標：40（あと+Xpt）

[意味説明]（例：40を超えると「売られすぎ」から完全脱出。上昇の勢いが出てくる目安です）

② **価格が短期平均（25日）を上抜け**

現在：XX,XXX,XXX円

目標：XX,XXX,XXX円（+X.X%、約XX万円上）

[意味説明]（例：これが最初の壁。ここを明確に超えると、トレンド転換への期待が高まります）

③ **雲への接近/突破** → 強弱の変化

現在：雲の[上/中/下]（[上限/下限]まで約XX万円、±X.X%）

[意味説明と状態]（例：⚠️ 雲の下限まで接近すると重要な局面です。しかし雲は約XXX万円分の厚さがあるため、突破には相当な勢いが必要です）

# 📝 まとめ

**一言の結論**：
[全体を踏まえた一言結論]（例：「反発の芽は出つつあるが、まだ弱気構造。無理のない運用を心がけましょう」）

**補足**：
- この分析は日足（1日単位）の技術指標に基づいています
- 重要なニュース（規制・大手企業の動向など）や出来高の急増があれば、評価は大きく変わる可能性があります
- 短期的な値動きは予測困難です。長期的な視点を持つことをお勧めします

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。` }]
      }
    ],
    metadata: {
      level: PromptLevel.BEGINNER,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '30秒',
      tags: ['beginner', 'btc', 'trend', 'price']
    }
  },
  {
    name: '🔰 ETHの価格を分析して',
    description: 'イーサリアムの最近の価格動向とトレンドを初心者向けに分析',
    messages: [
      {
        role: 'assistant', content: [{
          type: 'text', text: `最近のETHの動きを初級者向けに分析してください。

【表現ルール】
1. 専門用語は「わかりやすい言葉（正式名称）」で併記
   例: 加熱度（RSI）、平均価格（移動平均線）、トレンドの雲（一目均衡表）
2. 初出の指標には1行説明を添える
3. 数値だけでなく「意味」を説明
4. 指標間の関係性・整合性を明示
5. チャート不要、テキストのみ
6. 視覚的なゲージや絵文字を活用して直感的に理解できるようにする

【分析の流れ（ツールは3つ）】
1) get_candles(pair="eth_jpy", type="1day", limit=90)
   → 価格推移と出来高（contentに計算済み情報あり）
2) analyze_market_signal(pair="eth_jpy", type="1day")
   → 総合スコア、SMA詳細、補足指標（RSI・一目・MACD）を取得
3) analyze_indicators(pair="eth_jpy", type="1day", limit=50)
   → RSI推移（直近7日間）を取得して視覚化

【出力形式】

# 📊 ETH分析レポート

# Part 1: 市場の動き

## 📈 価格推移（3つの期間で比較）

【データソース】get_candles の content から取得

**現在価格：¥XXX,XXX**

| 期間 | 価格 | 変化率 | 判定 |
|------|------|--------|------|
| 1週間前 | ¥XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |
| 1ヶ月前 | ¥XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |
| 3ヶ月前 | ¥XXX,XXX | ±X.X% | [↗️上昇/↘️下落/→横ばい] |

💡 [期間ごとの動きを1-2行で要約]
（例：短期では下落傾向ですが、3ヶ月で見ると上昇基調を維持しています）

※判定基準：+2%以上=上昇、-2%以下=下落、±2%以内=横ばい

## 💰 取引の活発さ

【データソース】get_candles の content「出来高推移」から取得

**直近1週間の出来高：XXX ETH/日**（前週比 ±XX.X%）

判定：[📈活発/📉落ち着いている/→通常]

💡 [出来高の意味を1行で]
（例：取引量は前週より増加しており、市場参加者の関心が高まっています）


# Part 2: 3つの主要指標で分析

## 総合スコア

**総合スコア：XX / 100**（[解釈テキスト]）

\`\`\`
-100 ◄──────────────┼──────────────► +100
       弱気        中立       強気
                    ▲
                  今ココ
\`\`\`

## 1️⃣ 加熱度（RSI）

**RSIとは**：0-100で測る指標。30以下=売られすぎ、70以上=買われすぎを示します。

**現在値：XX.X**
\`\`\`
[████░░░░░░] XX/100
\`\`\`
↑ [状態の説明]（例：売られすぎに近い、30以下で反発期待）

**📊 直近7日間の推移**：  
[analyze_indicators の本文から「RSI推移（直近7日）」を数値→矢印形式でそのまま引用]  
例: 25.6 → 23.4 → 16.1（底） → 33.4 → 32.2 → 34.4 → 35.7  
└─ [推移の解釈] [📈上昇中/📉下降中/→横ばい] [一言コメント]

※ ASCIIアートの折れ線グラフは描かないこと（位置ずれが発生するため）

**注意点**：
[RSI特有の注意点を1行で]（例：強いトレンド中は30以下・70以上が続くこともあります）

※ゲージの作り方：RSI値を10で割った数だけ█、残りは░（10ブロック制）


## 2️⃣ トレンドの強さ（移動平均線）

| 期間 | 移動平均価格 | 価格との差 | 判定 |
|------|-------------|-----------|------|
| 短期（25日） | XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |
| 中期（75日） | XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |
| 長期（200日） | XXX,XXX円 | +X.X% 上/下 | 🟢強気/🔴弱気/🟡中立 |

**移動平均線とは**：過去の平均価格を結んだ線。トレンド（方向性）を見る基本指標です。

**今の状態**：
[全体的な配置とトレンドを1-2行で]
（例：全ての移動平均線が価格の上にある → **弱気構造**。価格が短期線（約XX万円）を明確に超えない限り、本格的な上昇トレンドとは言えません）

**直近の動き**：
[クロスやその他の動きがあれば記載]
（例：9日前に短期線（25日）が中期線（75日）を上抜け（ゴールデンクロス）。短期的な反発開始のサインですが、まだ価格は全ての平均線の下にあります）

※判定の見方：
- 🟢強気：価格がその平均線より上（上昇傾向）
- 🔴弱気：価格がその平均線より下（下落傾向）
- 🟡中立：ほぼ同じ位置（転換期・横ばい）


## 3️⃣ トレンドの雲（一目均衡表）

**一目均衡表とは**：価格と「雲」（抵抗・支持帯）の位置関係でトレンドを判断する指標です。

**現在位置**：[雲の上🟢/雲の中🟡/雲の下🔴]

【雲の下（弱気）の場合】
\`\`\`
    ╔═══════════════════════╗
    ║ XXX,XXX円  雲上端     ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XXX,XXX円  雲下端     ║
    ╚═══════════════════════╝
         ↑ +X.X% 上方
 📍 XXX,XXX円 ━━ 現在価格
\`\`\`

【雲の上（強気）の場合】
\`\`\`
 📍 XXX,XXX円 ━━ 現在価格
         ↓ -X.X% 下方
    ╔═══════════════════════╗
    ║ XXX,XXX円  雲上端     ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XXX,XXX円  雲下端     ║
    ╚═══════════════════════╝
\`\`\`

【雲の中（不透明）の場合】
\`\`\`
    ╔═══════════════════════╗
    ║ XXX,XXX円  雲上端     ║
    ║         ↑ +X.X%       ║
    ║ 📍 XXX,XXX円 現在     ║
    ║         ↓ -X.X%       ║
    ║ XXX,XXX円  雲下端     ║
    ╚═══════════════════════╝
\`\`\`

- 雲との距離：±X.X%（雲の[上端/下端]まで約X万円）
- 雲の厚さ：X.X%（約X万円）

💡 [状態の説明を1-2行で]
（例：雲の下にいるため、上昇には雲を突破する必要があります。雲は厚く、強い抵抗として機能しています）


## 📊 3指標の関係性

**整合性**：

| 指標 | 状態 | 判定 |
|------|------|------|
| RSI | XX | 🟢/🔴/🟡 |
| 移動平均線 | [配置] | 🟢/🔴/🟡 |
| 一目均衡表 | [位置] | 🟢/🔴/🟡 |

**総合解釈**：
[3つの指標を統合した解釈を2-3行で]
（例：「RSIは反発余地があり売られすぎ圏から脱出中🟡、しかし移動平均線・一目ともに弱気構造🔴。短期的な反発はあっても、上値は重い展開が予想されます」）


## 🎯 今後の注目ポイント

① **RSIが40回復** → 反発継続の兆し

現在：XX → 目標：40（あと+Xpt）

[意味説明]（例：40を超えると「売られすぎ」から完全脱出。上昇の勢いが出てくる目安です）

② **価格が短期平均（25日）を上抜け**

現在：XXX,XXX円

目標：XXX,XXX円（+X.X%、約X万円上）

[意味説明]（例：これが最初の壁。ここを明確に超えると、トレンド転換への期待が高まります）

③ **雲への接近/突破** → 強弱の変化

現在：雲の[上/中/下]（[上限/下限]まで約X万円、±X.X%）

[意味説明と状態]（例：⚠️ 雲の下限まで接近すると重要な局面です。しかし雲は約X万円分の厚さがあるため、突破には相当な勢いが必要です）

# 📝 まとめ

**一言の結論**：
[全体を踏まえた一言結論]（例：「反発の芽は出つつあるが、まだ弱気構造。無理のない運用を心がけましょう」）

**補足**：
- この分析は日足（1日単位）の技術指標に基づいています
- 重要なニュース（規制・大手企業の動向など）や出来高の急増があれば、評価は大きく変わる可能性があります
- 短期的な値動きは予測困難です。長期的な視点を持つことをお勧めします

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。` }]
      }
    ],
    metadata: {
      level: PromptLevel.BEGINNER,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '30秒',
      tags: ['beginner', 'eth', 'trend', 'price']
    }
  },

  // === Intermediate prompts (new) ===
  {
    name: '中級：主要指標でBTCを分析して',
    description: '中級者向け：RSI/MACD/ボリンジャーバンド/一目均衡表/移動平均線を一括取得して総合的に分析',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `代表的な指標を使ってBTCを分析して

【使用ツール】
analyze_indicators (pair=btc_jpy, type=1day, limit=200)

【分析方針】
1. 総合判定から全体像を把握
2. 各指標を横断的に確認
3. 矛盾する指標があれば明示
4. 次の注目ポイントを具体的に

【出力フォーマット】
※ 横線（━/─）は使わず、Markdownの見出し（# / ## / ###）で区切ること
※ 補足行（└ で始まる説明）のルール【厳守】:
  - 「└」は必ず新しい行の行頭に置くこと
  - 前の行の末尾に半角スペース2つを付けてMarkdown改行を入れる
  - 良い例（末尾にスペース2つ）:
    "RSI 34.5  " ← ここにスペース2つ
    "└ 売られすぎに接近"

# 📊 BTC/JPY 日足分析レポート

🔴/🟡/🟢 判定：[強気/中立/弱気]（一言で状態）

現在価格: XX,XXX,XXX円（前日比: ±X.X%）

## 📈 勢い指標

### 🌡️ RSI（加熱度）: [数値]

\`\`\`
███░░░░░░░ やや弱気
\`\`\`

RSIとは: 0-100で「買われすぎ/売られすぎ」を測る指標  
└ 30以下 = 売られすぎ → 反発しやすい  
└ 70以上 = 買われすぎ → 下落しやすい

【RSI推移（直近n日）】

[analyze_indicators の本文から引用した数値を1行で]

↑/↓ [推移を見て1行で分析コメント（例: 一週間前に24台まで下落後、回復基調に転じています）]

※「⚠️ 今の状態:」は出力しない（上記の分析コメントで代替）

✅ 転換サイン:
[条件]

### 📊 MACD: [数値]（[プラス/マイナス]圏）

【プログレスバーの描画ルール】
※ 基準値: ±150,000（BTC/JPY日足の実態に合わせた基準）
※ 計算式: マス数 = min(10, abs(ヒストグラム値) ÷ 15,000)
※ │が0の位置（中央固定）
※ マイナス値: 0（│）から左へ伸ばす
※ プラス値: 0（│）から右へ伸ばす

マイナス例（-69,814 → 5マス）:
\`\`\`
░░░░░█████│░░░░░░░░░░ 下落圧力強
  ◀ 弱気   0   強気 ▶
\`\`\`

プラス例（+80,000 → 5マス）:
\`\`\`
░░░░░░░░░░│█████░░░░░ 上昇圧力強
  ◀ 弱気   0   強気 ▶
\`\`\`

【パターン一覧】
- 大きなマイナス(-150,000): ██████████│░░░░░░░░░░
- 中くらいマイナス(-70,000): ░░░░░█████│░░░░░░░░░░
- 小さなマイナス(-15,000):  ░░░░░░░░░█│░░░░░░░░░░
- ゼロ付近(-5,000):         ░░░░░░░░░░│░░░░░░░░░░
- 小さなプラス(+15,000):    ░░░░░░░░░░│█░░░░░░░░░
- 中くらいプラス(+80,000):  ░░░░░░░░░░│█████░░░░░
- 大きなプラス(+150,000):   ░░░░░░░░░░│██████████

**MACDとは**: トレンドの「勢い」と「転換点」を見る指標

**ヒストグラムの見方**

ヒストグラムは「MACD線 - シグナル線」の差を棒グラフ化したもの
- プラス → 上昇の勢い
- マイナス → 下落の勢い
- マイナス→プラス = ゴールデンクロス（上昇転換）
- プラス→マイナス = デッドクロス（下落転換）

**現在の状態**
- MACD線: [数値]
- シグナル線: [数値]
- ヒストグラム: [数値]（MACD - シグナル）
- 状態: [🔴デッドクロス継続中 / 🟢ゴールデンクロス継続中]

**直近の動き**
- ヒストグラム: 前日 [数値] → 今日 [数値]（[±差分] [改善/悪化]）
  → [マイナス幅が縮小中 = 下落の勢いが弱まる兆し / マイナス幅が拡大中 = 下落加速]

**転換サイン**
✅ ゴールデンクロス: MACD線がシグナル線を上抜け（ヒストグラムがゼロ通過）
→ ゴールデンクロスまであと約[数値]ポイント

## 📉 トレンド指標

### 📏 移動平均線（価格の平均ライン）

移動平均線とは: 過去X日間の平均価格をつないだ線  
└ 現在の価格が線より上 = 上昇トレンド（強気の流れ）  
  ※ただし平均から大きく離れていると調整で下がる可能性も  
└ 現在の価格が線より下 = 下落トレンド（弱気の流れ）  
  ※ただし平均から大きく離れていると反発で上がる可能性も

- 25日線:  XX,XXX,XXX円（現在価格から ±X.X%）
- 75日線:  XX,XXX,XXX円（現在価格から ±X.X%）
- 200日線: XX,XXX,XXX円（現在価格から ±X.X%）

配置: [例: 価格 < 25日 < 75日 < 200日]
→ [強気配列/弱気配列/混在]

### ☁️ 一目均衡表: [🔴三役逆転/🟢三役好転/🟡中立]

**一目とは**: 雲でトレンドを見る指標（雲の上=強気、下=弱気）

【一目均衡表の出力ルール】

1. 現在価格と雲の位置関係を判定
   - 価格 < 雲下端 → パターン1（雲の下）を使用
   - 雲下端 ≤ 価格 ≤ 雲上端 → パターン3（雲の中）を使用
   - 価格 > 雲上端 → パターン2（雲の上）を使用

2. 雲の囲みは二重線（╔═╗╚═╝║）を使用

**パターン1: 雲の下（弱気）**
\`\`\`
    ╔═══════════════════════╗
    ║ XX,XXX,XXX円  雲上端  ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XX,XXX,XXX円  雲下端  ║
    ╚═══════════════════════╝
         ↑ +X.X% 上方
 📍 XX,XXX,XXX円 ━━ 現在価格
\`\`\`

**パターン2: 雲の上（強気）**
\`\`\`
 📍 XX,XXX,XXX円 ━━ 現在価格
         ↓ -X.X% 下方
    ╔═══════════════════════╗
    ║ XX,XXX,XXX円  雲上端  ║
    ║                       ║
    ║   雲の厚さ X.X%       ║
    ║                       ║
    ║ XX,XXX,XXX円  雲下端  ║
    ╚═══════════════════════╝
\`\`\`

**パターン3: 雲の中（中立）**
\`\`\`
    ╔═══════════════════════════╗
    ║ XX,XXX,XXX円  雲上端      ║
    ║         ↑ +X.X%           ║
    ║                           ║
    ║ 📍 XX,XXX,XXX円 現在価格  ║
    ║    （雲の中で推移）       ║
    ║                           ║
    ║         ↓ -X.X%           ║
    ║ XX,XXX,XXX円  雲下端      ║
    ╚═══════════════════════════╝
\`\`\`

**三役の内訳**（3項目を箇条書き）
- 転換線 vs 基準線: XX,XXX,XXX円 [</>] XX,XXX,XXX円
- 価格 vs 雲: 雲の[上/中/下]で推移（±X.X%）
- 遅行スパン vs 価格: [上向き/下向き/横ばい]

→ [状況の意味を1行で補足。例: 雲が厚く上値抵抗が強い / 雲が下支えとして機能]

## 📐 ボラティリティ指標

### 📊 ボリンジャーバンド: [±Xσ位置]

ボリンジャーバンドとは: 価格が動く「通常の範囲」を帯で表示  
└ ±2σ = 約95%の確率でこの範囲に収まる  
└ バンド幅 = 広い→荒れ相場 / 狭い→静か

- +2σ: XX,XXX,XXX円（+X.X%）
- 中心: XX,XXX,XXX円
- -2σ: XX,XXX,XXX円（-X.X%）

現在位置: [±Xσ]
バンド幅: X.X%（[エクスパンション中/スクイーズ中]）

## 📍 重要な価格帯

【出力形式】コードブロックで縦の構造図を作成

\`\`\`
    XX,XXX,XXX円 ┄┄ [ライン名]（[説明]）+X.X%
         ↑
    XX,XXX,XXX円 ┄┄ [ライン名]（[説明]）+X.X%
         ↑
 📍 XX,XXX,XXX円 ┄┄ 現在価格 ←ココ
         ↓
    XX,XXX,XXX円 ┄┄ [ライン名]（[説明]）-X.X%
\`\`\`

※現在価格を中心に、上下それぞれ2-3本の重要ラインを配置
※各ラインには名称・意味・現在価格からの乖離率を記載

【必ず含めるライン】
- BB +2σ / -2σ（ボリンジャーバンド上下限）
- 雲上端 / 雲下端（一目均衡表の雲の範囲）
- 25日線 / 75日線 / 200日線（移動平均線）
※現在価格より上にあるものはレジスタンス、下にあるものはサポートとして配置

## ⚖️ 指標の総合判断

【見方が分かれる場合】
⚠️ **短期と中期で見方が分かれています**
- 🟡 **短期（勢い指標）**: [RSIやBBの数値と評価]
- 🔴 **中期（トレンド）**: [移動平均/一目の判定]
→ [矛盾の意味を1-2行で説明]

【見方が一致する場合】
✅ **主要指標の結論**: [方向性]
- 勢い: [要約]
- トレンド: [要約]

## 🎯 次の転換サイン

【反発シナリオの条件】
1. [条件1]: [価格や指標の具体値]
2. [条件2]: [価格や指標の具体値]
3. [条件3]: [価格や指標の具体値]

【下落継続シグナル】
- [条件1]
- [条件2]

## 💡 まとめ

[2-3行で結論]
- 現状の解釈
- 中期目線でのスタンス
- 最も注目すべきポイント

【出力例（勢い指標）】

### 🌡️ RSI（加熱度）: 34.33
███░░░░░░░ やや弱気

RSIとは: 0-100で「買われすぎ/売られすぎ」を測る指標  
└ 30以下 = 売られすぎ → 反発しやすい  
└ 70以上 = 買われすぎ → 下落しやすい

⚠️ 今の状態:
売られすぎ水準（30）に接近中
✅ 転換サイン:
RSIが30を割ってから反発、または40を回復

### 📊 MACD: -59,666（マイナス圏）
████████░░│░░░░░░░░░░ 下落圧力強
  ◀ 弱気   0   強気 ▶

MACDとは: トレンドの「勢い」と「転換点」を見る指標  
└ ヒストグラム = 勢いの強さを棒グラフ化したもの

❌ 今の状態:
ヒストグラムが大きなマイナス。下落の勢いが継続中
✅ 転換サイン:
ヒストグラムの縮小（マイナス幅が減少）→ ゴールデンクロス

【プログレスバーの表記ルール】
RSI（0-100ベース、左から右へ）:
- 0-30:   ███░░░░░░░ 売られすぎ
- 30-50:  █████░░░░░ やや弱気
- 50:     █████████░ 中立
- 50-70:  ███████░░░ やや強気
- 70-100: ██████████ 買われすぎ

MACD（中央が0、左が弱気・右が強気）:
- 大きなマイナス: ████████░░│░░░░░░░░░░ 下落圧力強
- 小さなマイナス: ░░░░░███░░│░░░░░░░░░░ 下落圧力弱
- ゼロ付近:       ░░░░░░░░░█│█░░░░░░░░░ 中立
- 小さなプラス:   ░░░░░░░░░░│░░███░░░░░ 上昇圧力弱
- 大きなプラス:   ░░░░░░░░░░│░░░░░░████ 上昇圧力強

※ MACDは │ を中央（0）として、マイナスは左へ、プラスは右へ伸びる

【絵文字の使い分け】
- ✅ ポジティブ/転換サイン
- ⚠️ 注意/警戒
- ❌ ネガティブ
- 🟢 強気
- 🟡 中立/様子見
- 🔴 弱気

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '1分',
      tags: ['intermediate', 'indicators', 'comprehensive', 'rsi', 'macd', 'bb', 'ichimoku', 'sma']
    }
  },
  {
    name: '中級：BTCのフロー分析をして',
    description: '中級者向け：直近の売買フロー（CVD/aggressor ratio）からマーケットの方向性を分析',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `BTCのフロー分析をやって

【使用ツール】
1) get_flow_metrics (pair=btc_jpy, limit=300, bucketMs=60000, view=detailed)
2) get_transactions (pair=btc_jpy, limit=200, view=summary)  ※必要に応じて

【分析方針】
1. CVD（累積出来高差分）のトレンド
   - プラス → 買い優勢、マイナス → 売り優勢
   - 急激な変化（スパイク）は注目イベント

2. Aggressor Ratio（仕掛け側の割合）
   - 50%以上 → 買いが積極的
   - 50%以下 → 売りが積極的

3. Volume Spike（出来高急増）
   - zscore > 2.0 の時間帯を特定
   - 価格変動との相関を確認

4. 直近1-3時間の流れを重視
   - バケット単位（1分）のデータから短期モメンタムを判定

【出力フォーマット】

**【重要】タイムスタンプの記載**
- レポート冒頭には「📸 YYYY/MM/DD HH:MM:SS JST 時点」形式でデータ取得時刻を記載してください

---

- 結論：買い優勢/売り優勢/拮抗（1-2行）
- CVDの推移（グラフ的説明 or 数値）
- 注目すべきスパイク（あれば）
- 価格への影響予測

専門用語OK。数値には単位と意味を明記。

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '1分',
      tags: ['intermediate', 'flow', 'cvd', 'volume', 'transactions', 'short-term']
    }
  },
  {
    name: '中級：BTCの板の状況を詳しく見て',
    description: '中級者向け：板の厚み・流動性分布・大口注文から短期的なサポート/レジスタンスを分析',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `BTCの板の状況を詳しく見て

【使用ツール】
1) get_orderbook (pair=btc_jpy, mode=statistics, ranges=[0.5,1,2], priceZones=10)
2) get_orderbook (pair=btc_jpy, mode=raw)  ※必要に応じて

【分析方針】
1. 流動性分布
   - ±0.5%/1%/2% の範囲での買い板・売り板の厚み
   - どの価格帯に注文が集中しているか

2. 大口注文の検出
   - 平均の2倍以上の注文（Bid/Ask）
   - 「壁」として機能する可能性のある価格帯

3. スプレッドとバランス
   - Bid/Ask のバランス（買い優勢/売り優勢）
   - スプレッドの広さ（流動性の評価）

4. 短期的なサポート/レジスタンス
   - 厚い買い板 → サポート（下がりにくい）
   - 厚い売り板 → レジスタンス（上がりにくい）

【出力フォーマット】

**【重要】タイムスタンプの記載**
- レポート冒頭には、取得したデータのタイムスタンプ（📸で始まる行）に「時点」を付けて記載してください（例：📸 2025/11/24 23:03:45 JST 時点）
- 板情報は秒単位で変動するため、「いつ時点のスナップショットか」を明示することが重要です
- 各ツールの出力に含まれるタイムスタンプをそのまま使用し、末尾に「時点」を追加してください

---

- 結論：買い圧力/売り圧力/拮抗（1-2行）
- 重要な価格帯（サポート/レジスタンス）
- 大口注文の位置（あれば）
- 短期トレードへの示唆

専門用語OK。価格帯は具体的な数値で明示。

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '1分',
      tags: ['intermediate', 'orderbook', 'depth', 'liquidity', 'support', 'resistance', 'short-term']
    }
  },
  {
    name: '中級：BTCのパターン分析をして',
    description: '中級者向け：短期（2本足）から中長期（大型パターン）まで、複数の時間軸でパターンを検出',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `BTCのチャートパターン分析

【核心ルール】
- 完成後80日以上のパターン → 完全に無視（言及しない）
- ネックライン/ターゲットから10%超離れている → 自動的に低影響度⚪
- 中間処理の説明は出力しない（最終結果のみ表示）

【ツール（2つ）】
1) detect_patterns(pair=btc_jpy, type=1day, limit=180, view=detailed, includeForming=true, includeCompleted=true, requireCurrentInPattern=true, currentRelevanceDays=80)
2) analyze_candle_patterns(pair=btc_jpy, type=1day, allow_partial_patterns=false)
   → パターン検出時は render_candle_pattern_diagram でSVG生成

【影響度判定】
| 条件 | 影響度 |
|------|--------|
| ±10%以内 + 高評価 | 🔴高 |
| ±10%以内 + 中評価 | 🟡中 |
| ±10%超 または 低評価 | ⚪低 |

【出力構成】

## 1. 形成中チャートパターン
切迫性順に記載。なければ「ℹ️ 検出なし」のみ。

各パターン:
- パターン名・方向性
- 完成度・重要水準（上限/下限ブレイク価格）
- 想定ターゲット

## 2. 完成済みチャートパターン
影響度順。80日以上経過は除外。

🔴高/🟡中: パターン名、期間、ネックライン、ターゲット到達度
⚪低（過去パターン）: 1行で簡潔に

## 3. 短期ローソク足パターン（2本足）
パターン名、確定日、方向性、過去実績（1/3/5日後）
なければ「ℹ️ 検出なし」

## 4. 総合解釈
- 短期/中期/長期の整合性
- 今後数日の注目点（2-3個）

## 5. シナリオ
📈強気: トリガー、ターゲット
📉弱気: トリガー、ターゲット
⏸️中立: 監視ポイント

---
⚠️ 免責事項：参考情報です。投資判断はご自身の責任で。`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '1分',
      tags: ['intermediate', 'patterns', 'chart-patterns']
    }
  },
  {
    name: '中級：BTCのサポレジを分析して',
    description: '中級者向け：過去の反応×板の厚み×直近の攻防から、価格帯の強弱を統合的に分析',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `BTCのサポート・レジスタンスを分析して

【分析ポリシー】
- チャートは出さない（数値・テキストのみ）
- 過去90日のローソク足からピボットポイント（swing high/low）ベースで反発/反落を検出し密度を計算
- 現在の板の厚みと照合し、整合性を評価
- 上下各2-3本の重要ラインに絞る
- 「強い/弱い」の根拠を必ず数値で示す
- **ツール実行後は直ちに最終出力へ移行、中間結果の説明は不要**

【使用ツール（この順）】

### 必須ツール
1. **analyze_support_resistance** (pair=btc_jpy, lookbackDays=90, topN=3)
   - 目的: 過去90日のサポート・レジスタンスを自動検出（サーバー側で正確に計算）
   - 出力: 各レベルの価格・強度（★1-3）・接触回数・接触日時・直近崩壊情報・recency score・bounce strength・pullback confirmation
   - 重要: このツールの出力（content）をそのまま使用。独自計算は不要

2. **get_orderbook** (pair=btc_jpy, mode=raw)
   - 目的: 現在の板の詳細分布を取得

3. **get_orderbook** (pair=btc_jpy, mode=pressure, bandsPct=[0.005, 0.01, 0.02])
   - 目的: ±0.5%/1%/2%の各帯域での買い/売り圧力を定量化

### 任意ツール（必要に応じて）
4. **analyze_sma_snapshot** (pair=btc_jpy, type=1day, periods=[25, 75, 200])
   - 目的: 移動平均線が心理的サポレジとして機能しているか確認

【分析手順】

### Step 1: サポート・レジスタンスツールの結果を解釈

**やること**:
1. \`analyze_support_resistance\` の出力（content）を確認
   - 各レベルの価格・距離（%）・強度（★）
   - **形成タイプ（従来型/新形成/転換型）** ← 重要
   - 接触回数と接触日時
   - 出来高ブースト情報
   - 補足説明（note）

2. 重要な注意事項:
   - ツールが出力した全ての情報をそのまま使用
   - 独自に日付を推測したり、接触回数を数え直したりしない
   - 形成タイプに応じて評価を変える：
     - **従来型**: 過去90日の反応実績ベース、最も信頼性高い
     - **新形成**: 安値切り上げによる新サポート、出来高で強度判定
     - **転換型（ロールリバーサル）**: 崩壊したサポート→レジスタンス転換、検証待ちで強度★、pullback confirmationありで★→★★

3. **判定ロジックの理解**:
   - ツールは3種類のサポート/レジスタンスを検出（ピボットポイントベースの検出 + %クラスタリングで集約）
   - A. 従来型：直近7日で終値ベースブレイクしていない、2回以上の反応実績（偽ブレイクアウト＝ヒゲ抜けのみは崩壊と見なさない）
   - B. 新形成：安値2日以上切り上げ + 以降割れなし
   - C. 転換型：崩壊したサポート→レジスタンス、突破したレジスタンス→サポート（pullback confirmationで強度昇格）
   - 有効なレベルが少ない場合でも、無理に枠を埋めない

### Step 2: 現在の板情報と照合

**やること**:
1. \`get_orderbook(mode=raw)\`の結果から、Step 1で検出された価格帯に大口注文が集中しているか確認
2. \`get_orderbook(mode=pressure)\`で各帯域の買い/売り優勢度を取得
3. 整合性を評価:
   - ✅ ツール検出レベル + 現在の板厚い = 信頼性高い
   - ⚠️ ツール検出レベル + 現在の板薄い = 機能しないリスク
   - ❌ ツール未検出 + 現在の板だけ厚い = 単なる一時的な壁

**【板情報の活用（重要）】**

\`get_orderbook(mode=raw)\` と \`get_orderbook(mode=pressure)\` で取得したデータを活用してください。ただし、bitbank APIの仕様上、通常±5-6%程度までの板しか存在しないことを理解した上で分析してください。

1. **第1サポート/レジスタンス（現在価格±3%以内）**
   - ±0.5%/±1%/±2%の板厚から直接評価
   - 具体的な数値（X BTC）を必ず記載
   - 例：「13,600,000円±0.5%に買い注文10.5 BTC」

2. **第2サポート/レジスタンス（現在価格から3-5%程度）**
   - \`get_orderbook(mode=raw)\` の範囲内であれば、該当価格帯の板を集計して記載
   - 範囲外の場合：「取得範囲外（bitbank板は通常±5%程度まで）のため板情報なし」
   - この場合、過去の反応頻度と強度のみで評価

3. **第3サポート/レジスタンス（現在価格から7%以上離れている）**
   - ほぼ確実に取得範囲外
   - ✅ 「現在価格から±X%離れており、取得範囲外のため板情報なし」と明記
   - ✅ **過去90日の反応回数・反発/反落の強度・出来高**を主要指標として評価
   - ✅ これらの実績データのみで★★★（強固）や★★（中程度）を判定することは正当

**【重要な注意】**
- 範囲外は事実なので、正直に記載することは正しい対応
- 「推測」「不明」などの曖昧表現は禁止
- 範囲外でも、過去の反応実績が豊富なら強度★★★を付けることは適切

### Step 3: 強度の最終評価と板情報の統合

**やること**:
1. \`analyze_support_resistance\` が既に強度（★1-3）を計算済み
   - この強度は過去の反応頻度・直近の維持状況・崩壊実績・recency decay・bounce strength・pullback confirmationを総合評価したもの
   - そのまま使用すること

2. 板情報による補足評価:
   - 範囲内（±5%程度）のレベル：板の厚みを追加評価材料として記載
   - 範囲外のレベル：「取得範囲外のため板情報なし」と明記

3. 最終的な強度表現:
   - ツールの★をそのまま使用
   - 板情報は「補足情報」として記載（強度の上書きはしない）

### Step 4: 直近7日の攻防確認

**やること**:
- 最重要サポート/レジスタンスが過去7日で何回試されたか
- 試された際のヒゲの長さ（反発/反落の勢い）
- 連続して試されている場合は「疲弊リスク」を警告

**【直近の攻防状況の記載ルール（最重要）】**

過去7-10日間のローソク足データから、サポート/レジスタンスの防衛状況を正確に判定してください。
特定の表現が含む暗黙のニュアンスに注意し、事実と異なる印象を与えないようにします。

**1. 使用禁止表現とそのニュアンス**

以下の表現は「まだ破られていない」という暗黙のニュアンスを含むため、一度でも割り込んだ場合は使用禁止です：
- 「試され」「試され防衛」→ まだ破られていない印象（一度も割り込んでいない場合のみ使用可能）
- 「防衛」「防衛中」→ 守り切っている印象（一度も割り込んでいない場合のみ使用可能）
- 「疲弊」「疲弊中」「疲弊リスク」→ 弱っているが耐えている印象（一度も割り込んでいない場合のみ使用可能）

**2. 「防衛」「試され」の厳密な定義**

使用可能な条件（厳格）：
- サポートの場合：過去7-10日間の安値が該当価格を一度も下回っていない
- レジスタンスの場合：過去7-10日間の高値が該当価格を一度も上回っていない

判定手順：
1. 過去7-10日分のローソク足データを確認
2. 各日の安値（サポート）または高値（レジスタンス）をチェック
3. 一度でも該当価格を超えていたら → 使用禁止

**3. 一度でも割り込んだ場合の正しい表現**

❌ 避けるべき表現：「過去5日で3回試され」「連続攻撃で疲弊中」「X回試され防衛しているが疲弊リスク」

✅ 正しい表現：
- 「X月X日に崩壊（最安/最高〇〇円、±X.X%）したが、X月X日に回復」
- 「一度破られた実績があり、信頼性が低下」
- 「崩壊から回復したが、再接触中でリスク高」
- 「過去5日で4回接触、うち1回崩壊（11/21、-7.2%）、3回防衛」
- 「脆弱性が露呈」「再割れリスク高」

**4. 実例による比較**

❌ 悪い例（実際に割り込んでいる場合）：「過去7日で3回試され現在4回目接触中→疲弊リスク高」
【問題点】「試され」→まだ破られていない印象、実際には11/21に-7.2%崩壊している事実が隠れる

✅ 良い例：「11/20に接触し防衛、11/21に崩壊（最安12,664,060円、-7.2%）、11/23-24で回復後、本日再接触中 ⚠️ 崩壊実績により信頼性低下、再割れリスク高」

✅ 「試され」「疲弊」を使える例（一度も割り込んでいない場合）：「過去5日で5回接触、いずれも防衛（安値13,620,000円で反発）⚠️ 5回連続防衛しているが疲弊の兆候、次回で崩れる可能性」

**5. 強度評価への反映**

直近7日以内に崩壊した価格帯：
- 過去90日の実績だけで判断せず、直近の崩壊実績を反映
- 強度を-1レベル減格、減格理由を明記
- 例：「過去90日で5回反発（本来★★★相当）だが、直近11/21に崩壊。崩壊実績により★★★から★★に減格」

**6. セクション間の整合性チェック（必須）**

出力前に以下を確認：
- チェック1: セクション1で「試され」「防衛」「疲弊」使用 → 該当期間で一度も割り込んでいないか再確認
- チェック2: セクション1で「試され」記載 → セクション2/3の「現状」で「崩壊」と矛盾していないか
- チェック3: セクション1で「防衛中」記載 → セクション5「注意点」で「崩壊実績あり」と矛盾していないか
- チェック4: 直近7日で崩壊した価格帯に★★★を付けていないか、減格理由が明記されているか

**表現の使い分けガイド**
- 中立的な表現（常に使用可能）：「接触」「再接触」「到達」「X回接触、うちY回崩壊、Z回防衛」
- 割り込んでいない場合：「防衛」「試され」「疲弊」「疲弊リスク」「次回で崩れる可能性」
- 割り込んだ場合：「崩壊」「破られた」「割り込み」「脆弱性」「信頼性低下」「再割れリスク」「再崩壊リスク」

【出力フォーマット】

**【重要】出力ルール（厳守）**
- **出力は必ず「📌 分析範囲について」から開始すること**
- 冒頭にデータ確認の経緯や中間結果を記載しない
- ツール呼び出しの結果説明も不要
- 以下のフォーマットに従い、追加の前置きや説明を挿入しないこと

---

**📌 分析範囲について**

本分析の板情報は、bitbank APIの仕様により現在価格から±5%程度の範囲で取得しています。
それより離れた価格帯は、過去の反応実績のみで評価しています。

---

## 1. 現在の状況（要約）

📍 **現在価格**: XX,XXX,XXX円

⚠️ **最重要ポイント**:
- [最も注意すべき状況を1行で（例: 第1サポート13,400,000円が3回目の試し→崩れるリスク高）]
- [板の買い/売りバランス（例: 売り圧力がやや優勢 買い6.9 vs 売り7.4 BTC）]
- [トレンドの方向性（例: 全てのSMAを大きく下回り、強い下落トレンド継続中）]

---

## 2. サポートライン（下値の支え）

**【重要】出力基準（厳守）**
- \`analyze_support_resistance\` で検出されたレベルのみ出力
- 有効なサポートがない場合は「明確なサポートラインは検出されませんでした」と記載
- 無理に枠を埋めない（1本でも2本でも、検出された数だけ出力）
- タイプ名（「新形成」「転換」等）は表示しない、平易な説明のみ

### 🟢 サポート: **XX,XXX,XXX円**（-X.X%）強度：★★★
- **背景**: [どうしてサポートになるのか平易に説明（例: 過去90日で5回反発、最終11/23。実績豊富で信頼性高い）]
- **板の状況**: [買い注文量と評価（例: 買い注文5.7 BTC、標準的な厚さ）]
- **意義**: [1行で（例: 割れると次のサポートまで-3%の空白地帯）]

### 🟢 サポート: **XX,XXX,XXX円**（-X.X%）強度：★★☆
- **背景**: [平易な説明（例: 11/21の急落で底を打ち、3日連続で安値切り上げ中。大出来高での反発）]
- **板の状況**: [買い注文量（範囲内の場合）]
- **意義**: [1行で（例: 直近の最安値、最終防衛ライン）]

### 🟢 サポート: **XX,XXX,XXX円**（-X.X%）強度：★☆☆
- **背景**: [平易な説明（例: 10/26に上抜けした価格帯。現在は「上抜け後の下支え」として機能する可能性）]
- **板の状況**: [買い注文量（範囲内の場合）]
- **注意**: [1行で（例: 11/21に一度崩壊済み、再割れリスク高）]

※ 検出された数だけ出力。「なぜサポートになりうるか」を平易に説明。

---

## 3. レジスタンスライン（上値の壁）

**【重要】出力基準（厳守）**
- \`analyze_support_resistance\` で検出されたレベルのみ出力
- 有効なレジスタンスがない場合は「明確なレジスタンスラインは検出されませんでした」と記載
- 無理に枠を埋めない（1本でも2本でも、検出された数だけ出力）
- タイプ名（「転換」等）は表示しない、平易な説明のみ

### 🔴 レジスタンス: **XX,XXX,XXX円**（+X.X%）強度：★★☆
- **背景**: [どうしてレジスタンスになるのか平易に説明（例: 過去90日で8回反落、最終11/15。実績豊富で信頼性高い）]
- **板の状況**: [売り注文量と評価（例: 売り注文2.3 BTC、平均の0.3倍→板が薄く突破しやすい）]
- **意義**: [1行で（例: 突破しても25日線15,334,347円（+14.3%）が次の強力な壁）]

### 🔴 レジスタンス: **XX,XXX,XXX円**（+X.X%）強度：★☆☆
- **背景**: [平易な説明（例: 11/21に崩壊した元サポート。現在は「戻り売りポイント」として機能する可能性）]
- **板の状況**: [売り注文量（範囲内の場合）]
- **注意**: [1行で（例: 転換直後で信頼性未確認、突破される可能性もあり）]

※ 検出された数だけ出力。「なぜレジスタンスになりうるか」を平易に説明。

---

## 4. シナリオ（3パターン）

### 📉 **下抜けシナリオ**（確率: 高/中/低）
- **トリガー**: XX,XXX,XXX円を終値で割る
- **ターゲット**: XX,XXX,XXX円（-X.X%）、最悪XX,XXX,XXX円（-X.X%）
- **根拠**: 
  - [理由1（例: 3回目の試しで疲弊）]
  - [理由2（例: 板の売り圧力優勢）]
  - [理由3（例: 強い下落トレンド継続中）]

### 📈 **上抜けシナリオ**（確率: 高/中/低）
- **トリガー**: XX,XXX,XXX円を出来高XXX BTC以上で突破
- **ターゲット**: XX,XXX,XXX円（+X.X%）
- **障壁**: [次の抵抗（例: 25日線15,334,347円（+14.3%））]

### ⏸️ **レンジ継続**（確率: 高/中/低）
- **条件**: XX,XXX,XXX円～XX,XXX,XXX円（幅X.X%）
- **監視**: 
  - [監視点1（例: 13,400,000円の4回目の試し）]
  - [監視点2（例: 出来高が400BTC超で急増）]
  - [監視点3（例: 板の買い注文の増減）]

---

## 5. 注意点

⚠️ **[カテゴリ1（例: 最重要リスク）]**: [具体的なリスクを1行で（例: 13,400,000円割れ→13,000,000円まで空白地帯-3%急落）]

⚠️ **[カテゴリ2（例: 疲弊の兆候）]**: [具体的なリスクを1行で（例: 3回連続試されており、本日の防衛が失敗する可能性）]

⚠️ **[カテゴリ3（例: 上値の重さ）]**: [具体的なリスクを1行で（例: 25日線+14.3%まで明確な買いシグナルなし）]

---

## 6. 構造図（視覚的サマリー）

セクション2・3で分析したサポート・レジスタンスを、以下のテキスト形式で視覚化してください。

**フォーマット:**

\`\`\`
構造図（テキスト版）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔴 XX,XXX,XXX円 ★★★ 第3レジスタンス (+XX.X%)
│
│        [注記がある場合はここに記載]
│
🔴 XX,XXX,XXX円 ★★ 第2レジスタンス (+XX.X%)
│
│        [注記]
│
🔴 XX,XXX,XXX円 ★★★ 第1レジスタンス (+XX.X%)
│
│        [注記]
│
├─────────────────────────────
📍 XX,XXX,XXX円 ← 現在価格
├─────────────────────────────
│
│
🟢 XX,XXX,XXX円 ★★★ 第1サポート (-XX.X%)
│
│        [注記] ⚠️ [リスクがある場合]
│
│  -X.X% 空白地帯
│
🟢 XX,XXX,XXX円 ★★ 第2サポート (-XX.X%)
│
│        [注記]
│
│
│
🟢 XX,XXX,XXX円 ★★★ 第3サポート (-XX.X%)
│
│        [注記]
│        板: 取得範囲外（±5-6%超）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【現在の市場構造】
- トレンド: [強い下落/横ばい/上昇等]
- 板の圧力: [買いやや優勢/売り優勢等] (+X.XX だが絶対量は中程度)
- 最重要ライン: XX,XXX,XXX円（第1サポート）
- リスク: [最も注意すべきリスクを1行で]
\`\`\`

**作成ルール:**

1. **縦軸配置**: 上から下へ（高値→現在価格→安値）の順
2. **絵文字**: 🔴レジスタンス、📍現在価格、🟢サポート
3. **強度**: ★の数（1-3個）でそのまま表示
4. **距離**: 各ラインの横に (+X.X%) または (-X.X%) を明記
5. **空白地帯**: サポート間の距離が2%以上ある場合は「-X.X% 空白地帯」と警告
6. **注記**: 各ラインの最も重要な情報を15文字以内で（例: "本日試し中"、"11/21-22に防衛"）
7. **リスク警告**: 疲弊リスクや急落リスクがある場合は ⚠️ を付ける
8. **市場構造サマリー**: 最後に4項目で現状をまとめる

**注記の選定基準:**
- 第1サポート/レジスタンス: 「現状」から選ぶ（試されている状況・距離）
- 第2・第3: 「根拠」または「意義」から最も特徴的なものを選ぶ

**板情報記載の良い例:**

🟢 第2サポート: 13,300,000円（-2.4%）強度：★★★
│
│        11/21-22に2回連続防衛
│        板: 13,265,000-13,335,000円に買い7.2 BTC（±1%で13.8 BTC、厚め）

🔴 第1レジスタンス: 14,000,000円（+2.7%）強度：★★☆
│
│        8回反落、心理的節目
│        板: 13,930,000-14,070,000円に売り4.6 BTC（やや薄め、突破可能性あり）

**板情報記載の悪い例（禁止）:**

❌ 🟢 第2サポート: 13,300,000円（-2.4%）強度：★★★
│
│        現在価格から遠く、板情報は限定的だが過去の反発実績が豊富

❌ 🔴 第2レジスタンス: 14,500,000円（+6.4%）強度：★★★
│
│        売り板の詳細は不明だが過去の実績から強固と推測

**範囲外の場合の良い例:**

✅ 🟢 第3サポート: 12,600,000円（-7.6%）強度：★★★
│
│        過去90日で5回反発、うち3回は下ヒゲ2.5%以上
│        板: 現在価格から-7.6%離れており取得範囲外（bitbank板は通常±5%程度まで）
│        過去の反発実績から強度★★★と評価

【表現ルール】

### 数値表記
- 価格: カンマ区切り（14,520,000円）
- パーセント: 小数点1桁まで（+2.3%）
- BTC数量: 小数点1桁まで（12.5 BTC）

### 強度評価（ツールが自動計算済み）
- ★★★：複数回の反発/反落実績あり、信頼性高
- ★★☆：実績あり、または出来高を伴う反発
- ★☆☆：転換候補、信頼性未確認

※ツールが自動判定：従来型は接触回数・直近の維持・出来高で評価、新形成は基本★★☆（出来高1.5倍以上で★★★）、転換型は基本★☆☆（pullback confirmationありで★★☆）

### 絵文字使用
- ✅: 整合性あり、信頼性高い
- ⚠️: 注意が必要、リスクあり
- ❌: 整合性なし、機能しない可能性
- 📈: 上抜けシナリオ
- 📉: 下抜けシナリオ
- ⏸️: レンジ継続
- 🔴: レジスタンス
- 🟢: サポート
- 📍: 現在価格

### トーン
- 専門用語OK（中級者向け）
- 根拠は必ず数値で示す
- 断定を避け、「～の可能性」「～と推測される」等の表現を使用

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '1-2分',
      tags: ['intermediate', 'support', 'resistance', 'price-levels', 'orderbook', 'candles', 'comprehensive']
    }
  },
  {
    name: '🌅 おはようレポート',
    description: '【検証用】直近8時間の価格動向を HTML ダッシュボードで視覚化。Claude Desktop 推奨。',
    messages: [
      {
        role: 'assistant',
        content: [{
          type: 'text',
          text: `直近8時間で何が起きたかを **HTML ファイル** で視覚化してください。

【使用ツール】
1. get_ticker(pair="btc_jpy") → リアルタイム現在価格
2. get_candles(pair="btc_jpy", type="1hour", limit=24) → 直近24時間の1時間足（出来高棒グラフ用）
3. get_flow_metrics(pair="btc_jpy", limit=300, bucketMs=60000) → 急騰/急落スパイク、売買バランス
4. analyze_support_resistance(pair="btc_jpy", lookbackDays=90, topN=3) → サポート/レジスタンスライン
5. get_orderbook(pair="btc_jpy", mode=pressure, bandsPct=[0.005, 0.01, 0.02]) → 板の買い/売り圧力

【出力形式】
取得したデータを使って、以下の構成の **HTML ファイル** を生成してください。

## 必須コンポーネント

### 1. ヘッダー部
- タイトル: 「🌅 直近8時間レポート」
- 取得時刻（YYYY-MM-DD HH:MM JST）

### 2. 価格サマリーカード
- 8時間前の価格 → 現在価格
- 変動率（±X.X%）と方向アイコン（📈上昇 / 📉下落 / ➡️横ばい）
- 高値・安値とその時刻
- SVGで簡易的な価格レンジバーを表示
  - 安値〜高値の範囲内で現在価格の位置を示すマーカー

### 3. イベントタイムライン
- 急騰🚀/急落💥イベントを時系列で表示
- 各イベントに時刻、変動率、簡易説明
- イベントがない場合は「✅ 大きな急変動はありませんでした」

### 4. 売買バランスカード（横並び2カード）

**カード A: 出来高（24時間棒グラフ）**
- 直近24時間の出来高を時間ごとの棒グラフで表示
- 直近8時間分は色を変えてハイライト（例：緑系 bg-green-500）
- それ以前の16時間分は薄い色（例：グレー系 bg-gray-600）
- **重要**: 棒の高さは px 単位で直接指定（例: style="height: 48px"）。パーセント指定は効かないため禁止
- 最大出来高の棒を 96px とし、他は比率で計算（例: 出来高が最大の50%なら 48px）
- 8時間合計: XXX BTC を数値で明記
- 突出した時間帯があれば注記（例：「09時台が突出」）

**カード B: 売買比率**
- 買い/売りの比率バー（CSS グラデーション）
- パーセント表示
- 判定ラベル（🟢買い優勢 / 🔴売り優勢 / 🟡拮抗）

### 5. 重要ラインとの関係（縦型構造図）
- **縦型レイアウト**で上から下へ表示（横型は数字が重なるためNG）
- 構造イメージ:
  🔴 第3レジスタンス（+17.3%）11,850,000円 ★☆☆
  │   説明テキスト
  🔴 第2レジスタンス（+14.8%）11,600,000円 ★☆☆
  │   説明テキスト
  🔴 第1レジスタンス（+12.8%）11,400,000円 ★☆☆
  │
  │   空白地帯（レジスタンスまで遠い）
  ────────────────────
  📍 現在価格: 10,106,297円
  ────────────────────
  │   板情報: ±0.5%: 買X.X BTC / 売X.X BTC
  │
  🟢 サポート（-7.0%）9,400,000円 ★☆☆
      説明テキスト
- 各ラインに強度（★）、距離（%）、説明を併記
- サポートなしの場合は「本日安値 X円 が直近の底」と表示

### 6. 板状況カード
- ±1%帯域の買い/売り圧力バー
- BTC数量表示
- 判定ラベル（🟢買い圧力優勢 / 🔴売り圧力優勢 / 🟡均衡）

### 7. ポイントセクション
- 1-2行で今日の判断材料をまとめる（テキスト）

### 8. 免責事項フッター
- 「この分析は参考情報です。投資判断はご自身で行ってください。」

## デザイン要件

\`\`\`
- ダークテーマ
  - 背景: #1a1a2e
  - カード背景: #16213e
  - テキスト: #eaeaea
  - アクセント: #0f3460
  
- 色の意味
  - 緑系 (#4ade80): ポジティブ/上昇/買い
  - 赤系 (#f87171): ネガティブ/下落/売り
  - 黄系 (#fbbf24): 中立/注意
  - 青系 (#60a5fa): 情報/イベント
  
- レイアウト
  - 最大幅: 800px
  - カード: 角丸(8px)、影あり
  - フォント: システムフォント
  
- Tailwind CSS（jsdelivr の pre-built CSS）を使用
  - カスタムカラーは \`<style>\` ブロックで定義（arbitrary value 構文 \`bg-[#xxx]\` は使わない）
\`\`\`

## 出力テンプレート

\`\`\`html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .bg-dark  { background-color: #1a1a2e; }
    .bg-card  { background-color: #16213e; }
    .bg-accent { background-color: #0f3460; }
  </style>
  <title>直近8時間レポート</title>
</head>
<body class="bg-dark text-gray-100 min-h-screen p-6">
  <div class="max-w-3xl mx-auto space-y-6">
    
    <!-- ヘッダー -->
    <header class="text-center">
      <h1 class="text-2xl font-bold">🌅 直近8時間レポート</h1>
      <p class="text-gray-400 text-sm">取得時刻: {timestamp}</p>
    </header>
    
    <!-- 価格サマリー -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">📊 価格の動き</h2>
      <div class="flex justify-between items-center mb-4">
        <div>
          <p class="text-gray-400 text-sm">8時間前</p>
          <p class="text-xl">{price_before}円</p>
        </div>
        <div class="text-3xl">{direction_icon}</div>
        <div class="text-right">
          <p class="text-gray-400 text-sm">現在</p>
          <p class="text-xl font-bold">{price_now}円</p>
        </div>
      </div>
      <div class="text-center mb-4">
        <span class="{change_color} text-lg font-bold">{change_pct}%</span>
      </div>
      <!-- 価格レンジバー（SVG） -->
      <div class="relative h-8 bg-gray-700 rounded">
        <!-- 安値・高値・現在価格のマーカー -->
      </div>
      <div class="flex justify-between text-sm text-gray-400 mt-1">
        <span>安値: {low}円 ({low_time})</span>
        <span>高値: {high}円 ({high_time})</span>
      </div>
    </section>
    
    <!-- イベントタイムライン -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">⚡ 主なイベント</h2>
      <div class="space-y-3">
        <!-- イベント項目 or 「大きな急変動なし」 -->
      </div>
    </section>
    
    <!-- 出来高（24時間棒グラフ） -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">📈 出来高（直近24時間）</h2>
      <!-- 24本の棒グラフ: 高さは必ず px 単位で指定（%は効かない） -->
      <div class="flex items-end gap-1" style="height: 96px;">
        <!-- 例: 最大出来高=96px, 50%なら48px, 25%なら24px -->
        <!-- 直近8時間: bg-green-500, それ以前: bg-gray-600 -->
        <div class="w-3 bg-gray-600 rounded-t" style="height: 24px;"></div>
        <div class="w-3 bg-gray-600 rounded-t" style="height: 36px;"></div>
        <!-- ... 残り22本 ... -->
        <div class="w-3 bg-green-500 rounded-t" style="height: 72px;"></div>
        <div class="w-3 bg-green-500 rounded-t" style="height: 96px;"></div>
      </div>
      <p class="text-xs text-gray-500 mt-1">※ 時刻はJST。■ 直近8時間 / ■ それ以前</p>
      <p class="text-sm text-gray-400 mt-2">直近8時間合計: XXX BTC</p>
    </section>
    
    <!-- 売買比率 -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">⚖️ 売買比率</h2>
      <!-- 買い/売りの比率バー -->
    </section>
    
    <!-- 重要ライン（縦型構造図） -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">📍 重要ラインとの関係</h2>
      <!-- 縦型で上から下へ: レジスタンス → 現在価格 → サポート -->
      <div class="font-mono text-sm space-y-2">
        <!-- 各ラインを縦に並べる（横型は数字が重なるためNG） -->
      </div>
    </section>
    
    <!-- 板状況 -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-4">🔮 今の板状況</h2>
      <!-- ±1%帯域の買い/売り圧力バー -->
    </section>
    
    <!-- ポイント -->
    <section class="bg-card rounded-lg p-6">
      <h2 class="font-bold mb-3">💡 ポイント</h2>
      <p class="text-gray-300">{summary_text}</p>
    </section>
    
    <!-- 免責事項 -->
    <footer class="text-center text-gray-500 text-xs">
      ⚠️ この分析は参考情報です。投資判断はご自身で行ってください。
    </footer>
    
  </div>
</body>
</html>
\`\`\`

**重要**:
- \`create_file\` で \`/mnt/user-data/outputs/morning-report-visual.html\` を作成
- \`present_files\` で提示
- コードブロックでの出力やテキスト説明は不要
- Tailwind CSS（jsdelivr pre-built CSS）を使用。\`<script src="https://cdn.tailwindcss.com">\` は本番非推奨の警告が出るため使わない
`
        }]
      }
    ],
    metadata: {
      level: PromptLevel.INTERMEDIATE,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '30秒',
      tags: ['intermediate', 'btc', 'overnight', 'visual', 'html', 'artifact', 'experimental']
    }
  },
  {
    name: '🔰 今注目のコインは？',
    description: '出来高や価格変動から注目されている銘柄を抽出',
    messages: [
      {
        role: 'assistant', content: [{
          type: 'text', text: `今注目されているコインある？

【効率的な回答方法】
1. get_tickers_jpy を1回だけ呼び出す
2. 取得したデータから以下の順序で抽出:
   - **24時間上昇率トップ3**（価格の上がり）
   - **取引量トップ3**（取引の活発さ）
3. 個別の詳細分析（analyze_market_signal等）は不要

【出力フォーマット】

## 24時間上昇率トップ3

1. XYM（シンボル）  
   a. 価格：1.03円  
   b. 24時間の変化率：**+21.32%**  
   c. 24h取引量：9,648万円

2. （次のコイン）  
   ...

## 取引量トップ3

1. BTC（ビットコイン）  
   a. 価格：13,709,888円  
   b. 24時間の変化率：+0.83%  
   c. 24h取引量：**38.8億円**

2. （次のコイン）  
   ...

【フォーマットルール】
- 項目番号: 1, 2, 3（各セクション内で）
- サブ項目: a, b, c（各行の末尾にスペース2つで改行）
- 24時間上昇率トップ3: 「b. 24時間の変化率」を**太字**で強調
- 取引量トップ3: 「c. 24h取引量」を**太字**で強調
- 価格は「円」表記（¥マークは使わない）
- チャートは不要

---

⚠️ 免責事項：この分析は参考情報であり、解釈には誤差が含まれる場合があります。

板情報は秒単位で変動するため、実際のトレード前には最新状況を再確認してください。

投資判断はご自身の責任でお願いします。` }]
      }
    ],
    metadata: {
      level: PromptLevel.BEGINNER,
      category: PromptCategory.ANALYSIS,
      estimatedTime: '30秒',
      tags: ['beginner', 'ranking', 'volume', 'attention']
    }
  },


  {
    name: 'test_simple',
    description: 'テスト用シンプルPrompt',
    messages: [
      {
        role: 'user',
        content: [
          { type: 'text', text: 'ビットコインの現在の価格を教えてください。' }
        ]
      }
    ],
    metadata: {
      level: PromptLevel.BEGINNER,
      category: PromptCategory.ANALYSIS,
      tags: ['test']
    }
  },
  // === Beginner analysis-only prompts (tools only; no chart rendering) ===



];


// 日本語名のプロンプトのみを MCP に公開（英語名は非表示）
// 日本語名のみ + 指定順に並べ替えて公開
const desiredOrder = [
  '🌅 おはようレポート',
  '🔰 BTCの価格を分析して',
  '🔰 ETHの価格を分析して',
  '🔰 今注目のコインは？',
  '中級：主要指標でBTCを分析して',
  '中級：BTCのフロー分析をして',
  '中級：BTCの板の状況を詳しく見て',
  '中級：BTCのパターン分析をして',
  '中級：BTCのサポレジを分析して',
];
const orderIndex = (name: string) => {
  const i = desiredOrder.indexOf(name);
  return i >= 0 ? i : Number.MAX_SAFE_INTEGER;
};
export const prompts: PromptDef[] = promptsAll
  .filter(p => /[^\x00-\x7F]/.test(p.name))
  .sort((a, b) => orderIndex(a.name) - orderIndex(b.name));
